<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Love - Nhi M√≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        /* --- C·∫§U H√åNH CHUNG --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            overflow: hidden;
            font-family: 'Dancing Script', cursive;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- M√ÄN H√åNH CH·ªú (TR√ÅI TIM QR) --- */
        #start-screen {
            position: relative;
            cursor: pointer;
            z-index: 100;
            transition: opacity 1s, transform 1s;
        }

        .heart-box {
            width: 200px;
            height: 200px;
            position: relative;
            animation: heartbeat 1.5s infinite;
        }

        .heart-shape {
            width: 100%;
            height: 100%;
            background-color: #ff0033;
            background-image: 
                linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000),
                linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000);
            background-size: 10px 10px;
            background-position: 0 0, 5px 5px;
            clip-path: path('M100 28.67c-23.36-41.53-97.16-37.49-99.78 28.52-1.39 35.1 36.3 77.29 99.78 122.81 63.48-45.52 101.17-87.71 99.78-122.81-2.62-66.01-76.42-70.05-99.78-28.52z');
            box-shadow: 0 0 50px #ff0033;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .glow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 51, 0.4);
            filter: blur(20px);
            z-index: -1;
            clip-path: path('M100 28.67c-23.36-41.53-97.16-37.49-99.78 28.52-1.39 35.1 36.3 77.29 99.78 122.81 63.48-45.52 101.17-87.71 99.78-122.81-2.62-66.01-76.42-70.05-99.78-28.52z');
            animation: pulse-glow 2s infinite;
        }

        .tap-hint {
            color: #fff;
            text-align: center;
            margin-top: 20px;
            font-size: 20px;
            text-shadow: 0 0 10px #ff0033;
            animation: fadeInOut 2s infinite;
        }

        /* --- HI·ªÜU ·ª®NG BAY (TEXT & ·∫¢NH) --- */
        #effect-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: none;
            z-index: 10; /* N·∫±m tr√™n canvas nh∆∞ng d∆∞·ªõi ch·ªØ ch√≠nh */
        }

        .flying-obj {
            position: absolute;
            bottom: -50px;
            color: #ff3366;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(255, 51, 102, 0.8);
            white-space: nowrap;
            opacity: 0;
            animation: floatUp linear forwards;
        }

        .flying-obj img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid #ff99aa;
            box-shadow: 0 0 15px #ff3366;
        }

        /* --- PH·∫¶N CU·ªêI: TR√ÅI TIM H·∫†T & CH·ªÆ --- */
        #final-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            max-width: 100vw; /* Responsive ƒëi·ªán tho·∫°i */
            max-height: 100vh;
            display: flex; 
            opacity: 0; /* ·∫®n b·∫±ng ƒë·ªô m·ªù ƒë·ªÉ canvas render ƒë√∫ng t·ªça ƒë·ªô */
            pointer-events: none; /* Tr√°nh click nh·∫ßm khi ƒëang m·ªù */
            transition: opacity 1s ease-in-out; /* Hi·ªáu ·ª©ng hi·ªán ra m∆∞·ª£t m√† */
            justify-content: center;
            align-items: center;
            z-index: 20;
        }

        /* Canvas hi·ªáu ·ª©ng h·∫°t */
        canvas#pinkboard {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            animation: animate 1.3s infinite;
            z-index: 1; /* N·∫±m d∆∞·ªõi ch·ªØ */
        }

        /* D√≤ng ch·ªØ ch√≠nh n·∫±m gi·ªØa tr√°i tim */
        .center-msg {
            position: relative;
            z-index: 2; /* N·∫±m tr√™n canvas */
            color: white;
            font-size: 2.5rem;
            text-shadow: 0 0 10px #ff0033, 0 0 20px #ff0033;
            text-align: center;
            line-height: 1.4;
            pointer-events: none;
        }
        
        .sub-text {
            font-size: 1.8rem;
            color: #ffccd5;
            margin-top: 10px;
            display: block;
        }

        /* --- KEYFRAMES --- */
        @keyframes heartbeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.15); }
            60% { transform: scale(1); }
        }
        @keyframes pulse-glow {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        @keyframes floatUp {
            0% { transform: translateY(0) translateX(0) scale(0.5); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-110vh) translateX(20px) scale(1); opacity: 0; }
        }
        @keyframes animate {
            0% { transform: scale(1); }
            30% { transform: scale(.8); }
            60% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .fade-out {
            opacity: 0;
            transform: scale(2);
            pointer-events: none;
        }
    </style>
</head>
<body>

    <audio id="bg-music">
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <div id="start-screen" onclick="startLove()">
        <div class="heart-box">
            <div class="glow"></div>
            <div class="heart-shape">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=80x80&data=Love&color=fff&bgcolor=ff0033" style="width:60px; opacity:0.8; mix-blend-mode: overlay;">
            </div>
        </div>
        <div class="tap-hint">Ch·∫°m ƒë·ªÉ m·ªü qu√† ‚ù§Ô∏è</div>
    </div>

    <div id="effect-container"></div>

    <div id="final-container">
        <canvas id="pinkboard"></canvas>
        <div class="center-msg">
            Happy Valentine<br>
            <span style="font-size:35px; color: #ff99aa;">Em Iu ‚ù§Ô∏è</span><br>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu bay
        const words = [
            "Oh my, my love", "Of the ordinary", "Happy Valentine's Day", 
            "14/02/2026", "Y√™u em r·∫•t nhi·ªÅu", "Nguy·ªÖn Th·ªã Y·∫øn Nhi", 
            "M√£i b√™n nhau nh√©", "My Angel", "‚ù§Ô∏è", "üíï", "üåπ", "‚ú®"
        ];
        // C·∫≠p nh·∫≠t link ·∫£nh c·ªßa b·∫°n ·ªü ƒë√¢y
        const images = [
            "1.jpeg", "2.jpeg", "3.jpeg", "4.jpeg", "5.jpeg", "6.jpg", "7.jpg",
            "8.jpg", "9.jpg", "10.jpg", "11.jpg", "12.jpg", "13.jpg", "14.jpg"
        ];

        let isPlaying = false;

        function startLove() {
            if (isPlaying) return;
            isPlaying = true;

            // ·∫®n m√†n h√¨nh ch·ªù
            const startScreen = document.getElementById('start-screen');
            startScreen.classList.add('fade-out');
            
            // Ph√°t nh·∫°c
            const audio = document.getElementById('bg-music');
            audio.play().catch(e => console.log("C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ ph√°t nh·∫°c"));

            // Hi·ªán hi·ªáu ·ª©ng bay
            document.getElementById('effect-container').style.display = 'block';

            // Hi·ªán Tr√°i Tim H·∫°t + Ch·ªØ sau 2s b·∫±ng c√°ch tƒÉng opacity
            setTimeout(() => {
                const finalContainer = document.getElementById('final-container');
                finalContainer.style.opacity = '1';
                finalContainer.style.pointerEvents = 'auto'; // Cho ph√©p click l·∫°i n·∫øu c·∫ßn
            }, 2000);

            // T·∫°o m∆∞a ch·ªØ/·∫£nh
            setInterval(createItem, 100);
        }

        function createItem() {
            const container = document.getElementById('effect-container');
            const el = document.createElement('div');
            el.className = 'flying-obj';
            el.style.left = Math.random() * 90 + '%'; // Tr√°nh s√°t m√©p qu√°
            
            const fontSize = Math.random() * 20 + 12;
            el.style.fontSize = fontSize + 'px';

            const duration = Math.random() * 5 + 4; // Bay ch·∫≠m h∆°n ch√∫t ƒë·ªÉ d·ªÖ nh√¨n
            el.style.animationDuration = duration + 's';
            
            const rotate = (Math.random() - 0.5) * 45;
            el.style.transform = `rotate(${rotate}deg)`;

            if (Math.random() < 0.2 && images.length > 0) {
                const img = document.createElement('img');
                img.src = images[Math.floor(Math.random() * images.length)];
                img.onerror = function() { this.style.display='none'; }; // ·∫®n n·∫øu ·∫£nh l·ªói
                el.appendChild(img);
            } else {
                el.innerText = words[Math.floor(Math.random() * words.length)];
                const colors = ['#ff0033', '#ff6688', '#ffffff', '#ffccd5'];
                el.style.color = colors[Math.floor(Math.random() * colors.length)];
            }
            container.appendChild(el);
            setTimeout(() => { el.remove(); }, duration * 1000);
        }
    </script>

    <script>
    /*
     * Settings
     */
    var settings = {
        particles: {
            length: 1500, // S·ªë l∆∞·ª£ng h·∫°t (gi·∫£m ch√∫t ƒë·ªÉ ƒë·ª° lag tr√™n ƒët)
            duration: 2,
            velocity: 100,
            effect: -0.75, // Ch·ªânh l·∫°i ƒë·ªÉ h·∫°t t·ª• ƒë·∫πp h∆°n
            size: 28, // K√≠ch th∆∞·ªõc h·∫°t
        },
    };

    /* RequestAnimationFrame polyfill */
    (function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());

    /* Point class */
    var Point = (function() {
        function Point(x, y) {
            this.x = (typeof x !== 'undefined') ? x : 0;
            this.y = (typeof y !== 'undefined') ? y : 0;
        }
        Point.prototype.clone = function() { return new Point(this.x, this.y); };
        Point.prototype.length = function(length) {
            if (typeof length == 'undefined') return Math.sqrt(this.x * this.x + this.y * this.y);
            this.normalize();
            this.x *= length;
            this.y *= length;
            return this;
        };
        Point.prototype.normalize = function() {
            var length = this.length();
            this.x /= length;
            this.y /= length;
            return this;
        };
        return Point;
    })();

    /* Particle class */
    var Particle = (function() {
        function Particle() {
            this.position = new Point();
            this.velocity = new Point();
            this.acceleration = new Point();
            this.age = 0;
        }
        Particle.prototype.initialize = function(x, y, dx, dy) {
            this.position.x = x;
            this.position.y = y;
            this.velocity.x = dx;
            this.velocity.y = dy;
            this.acceleration.x = dx * settings.particles.effect;
            this.acceleration.y = dy * settings.particles.effect;
            this.age = 0;
        };
        Particle.prototype.update = function(deltaTime) {
            this.position.x += this.velocity.x * deltaTime;
            this.position.y += this.velocity.y * deltaTime;
            this.velocity.x += this.acceleration.x * deltaTime;
            this.velocity.y += this.acceleration.y * deltaTime;
            this.age += deltaTime;
        };
        Particle.prototype.draw = function(context, image) {
            function ease(t) { return (--t) * t * t + 1; }
            var size = image.width * ease(this.age / settings.particles.duration);
            context.globalAlpha = 1 - this.age / settings.particles.duration;
            context.drawImage(image, this.position.x - size / 2, this.position.y - size / 2, size, size);
        };
        return Particle;
    })();

    /* ParticlePool class */
    var ParticlePool = (function() {
        var particles, firstActive = 0, firstFree = 0, duration = settings.particles.duration;
        function ParticlePool(length) {
            particles = new Array(length);
            for (var i = 0; i < particles.length; i++) particles[i] = new Particle();
        }
        ParticlePool.prototype.add = function(x, y, dx, dy) {
            particles[firstFree].initialize(x, y, dx, dy);
            firstFree++;
            if (firstFree == particles.length) firstFree = 0;
            if (firstActive == firstFree ) firstActive++;
            if (firstActive == particles.length) firstActive = 0;
        };
        ParticlePool.prototype.update = function(deltaTime) {
            var i;
            if (firstActive < firstFree) {
                for (i = firstActive; i < firstFree; i++) particles[i].update(deltaTime);
            }
            if (firstFree < firstActive) {
                for (i = firstActive; i < particles.length; i++) particles[i].update(deltaTime);
                for (i = 0; i < firstFree; i++) particles[i].update(deltaTime);
            }
            while (particles[firstActive].age >= duration && firstActive != firstFree) {
                firstActive++;
                if (firstActive == particles.length) firstActive = 0;
            }
        };
        ParticlePool.prototype.draw = function(context, image) {
            if (firstActive < firstFree) {
                for (i = firstActive; i < firstFree; i++) particles[i].draw(context, image);
            }
            if (firstFree < firstActive) {
                for (i = firstActive; i < particles.length; i++) particles[i].draw(context, image);
                for (i = 0; i < firstFree; i++) particles[i].draw(context, image);
            }
        };
        return ParticlePool;
    })();

    /* Rendering */
    (function(canvas) {
        var context = canvas.getContext('2d'),
            particles = new ParticlePool(settings.particles.length),
            particleRate = settings.particles.length / settings.particles.duration,
            time;

        function pointOnHeart(t) {
            return new Point(
                160 * Math.pow(Math.sin(t), 3),
                130 * Math.cos(t) - 50 * Math.cos(2 * t) - 20 * Math.cos(3 * t) - 10 * Math.cos(4 * t) + 25
            );
        }

        var image = (function() {
            var canvas = document.createElement('canvas'),
                context = canvas.getContext('2d');
            canvas.width = settings.particles.size;
            canvas.height = settings.particles.size;
            function to(t) {
                var point = pointOnHeart(t);
                point.x = settings.particles.size / 2 + point.x * settings.particles.size / 350;
                point.y = settings.particles.size / 2 - point.y * settings.particles.size / 350;
                return point;
            }
            context.beginPath();
            var t = -Math.PI;
            var point = to(t);
            context.moveTo(point.x, point.y);
            while (t < Math.PI) {
                t += 0.01;
                point = to(t);
                context.lineTo(point.x, point.y);
            }
            context.closePath();
            context.fillStyle = '#FF5CA4';
            context.fill();
            var image = new Image();
            image.src = canvas.toDataURL();
            return image;
        })();

        function render() {
            requestAnimationFrame(render);
            var newTime = new Date().getTime() / 1000,
                deltaTime = newTime - (time || newTime);
            time = newTime;
            
            // Gi·ªõi h·∫°n th·ªùi gian update ƒë·ªÉ tr√°nh l·ªói v·ªát d√†i khi chuy·ªÉn tab web
            if (deltaTime > 0.05) deltaTime = 0.05;

            context.clearRect(0, 0, canvas.width, canvas.height);
            var amount = particleRate * deltaTime;
            for (var i = 0; i < amount; i++) {
                var pos = pointOnHeart(Math.PI - 2 * Math.PI * Math.random());
                var dir = pos.clone().length(settings.particles.velocity);
                particles.add(canvas.width / 2 + pos.x, canvas.height / 2 - pos.y, dir.x, -dir.y);
            }
            particles.update(deltaTime);
            particles.draw(context, image);
        }

        function onResize() {
            // L·∫•y k√≠ch th∆∞·ªõc t·ª´ parent div (#final-container)
            var parent = document.getElementById('final-container');
            if(parent) {
                canvas.width = parent.clientWidth;
                canvas.height = parent.clientHeight;
            }
        }
        
        window.onresize = onResize;
        
        // Kh·ªüi ƒë·ªông
        setTimeout(function() {
            onResize();
            render();
        }, 10);
    })(document.getElementById('pinkboard'));
    </script>
</body>
</html>